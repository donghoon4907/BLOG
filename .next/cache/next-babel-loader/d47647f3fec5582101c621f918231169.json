{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport PostPresenter from \"./PostPresenter\";\nimport { removePostMutation } from \"../../graphql/post/mutation/remove\";\nimport { likeMutation } from \"../../graphql/post/mutation/like\";\nimport { useVssState, useVssDispatch, SHOW_POST_MODAL, SHOW_LOGIN_MODAL } from \"../../context\";\nimport { getAccessToken } from \"../../lib/token\";\n\nconst PostContainer = ({\n  id,\n  title,\n  description,\n  createdAt,\n  user,\n  video,\n  status,\n  likes // room\n\n}) => {\n  const {\n    userId\n  } = useVssState();\n  const dispatch = useVssDispatch();\n  const isMyPost = userId || userId === user.id;\n  const {\n    0: ctrlIsLiked,\n    1: setCtrlIsLiked\n  } = useState(likes.some(v => v.user.id === userId));\n  const {\n    0: ctrlLikeCount,\n    1: setCtrlLikeCount\n  } = useState(likes.length);\n  const {\n    0: isShowUser,\n    1: setIsShowUser\n  } = useState(false);\n  const [like, {\n    loading: likeLoading\n  }] = useMutation(likeMutation);\n  const [remove, {\n    loading: removeLoading\n  }] = useMutation(removePostMutation);\n  const handleClickAvatar = useCallback(() => {\n    setIsShowUser(!isShowUser);\n  }, [isShowUser]); // 포스트 채팅방 접근 이벤트\n\n  const handleRoom = useCallback(() => {\n    const token = getAccessToken();\n\n    if (token) {//Router.push(`/room/${room.id}`);\n    } else {\n      dispatch({\n        type: SHOW_LOGIN_MODAL\n      });\n    }\n  }, []); // 포스트 수정 이벤트\n\n  const handleUpdate = useCallback(() => {\n    dispatch({\n      type: SHOW_POST_MODAL,\n      postId: id,\n      title,\n      description,\n      status,\n      url: video.url\n    });\n  }, []); // 좋아요 / 좋아요 취소 이벤트\n\n  const handleLike = useCallback(async () => {\n    const token = getAccessToken();\n\n    if (token) {\n      setCtrlIsLiked(!ctrlIsLiked);\n      setCtrlLikeCount(ctrlIsLiked ? ctrlLikeCount - 1 : ctrlLikeCount + 1);\n\n      try {\n        await like({\n          variables: {\n            postId: id\n          }\n        });\n      } catch (error) {\n        const {\n          message\n        } = JSON.parse(error.message);\n        alert(message);\n      }\n    } else {\n      dispatch({\n        type: SHOW_LOGIN_MODAL\n      });\n    }\n  }, [ctrlIsLiked, ctrlLikeCount, likeLoading]); // 삭제 이벤트\n\n  const handleDelete = useCallback(async () => {\n    if (removeLoading) {\n      return alert(\"요청중입니다. 잠시만 기다려주세요.\");\n    }\n\n    const tf = confirm(\"포스트를 삭제하시겠어요?\");\n\n    if (tf) {\n      try {\n        const {\n          data: {\n            deletePost\n          }\n        } = await remove({\n          variables: {\n            postId: id\n          }\n        });\n\n        if (deletePost) {\n          alert(\"포스트가 삭제되었습니다.\");\n          window.location.reload();\n        }\n      } catch (error) {\n        const {\n          message\n        } = JSON.parse(error.message);\n        alert(message);\n      }\n    }\n  }, [removeLoading]);\n  useEffect(() => {\n    setCtrlIsLiked(likes.some(v => v.user.id === userId));\n  }, [userId]);\n  return __jsx(PostPresenter, {\n    title: title,\n    description: description,\n    status: status,\n    createdAt: createdAt,\n    user: user,\n    video: video,\n    isLiked: ctrlIsLiked,\n    likeCount: ctrlLikeCount,\n    isMyPost: isMyPost,\n    isShowUser: isShowUser,\n    onClickAvatar: handleClickAvatar,\n    onLike: handleLike,\n    onUpdate: handleUpdate,\n    onRoom: handleRoom,\n    onDelete: handleDelete\n  });\n};\n\nexport default PostContainer;","map":{"version":3,"sources":["/Users/idonghun/Desktop/vss/frontend/components/post/PostContainer.tsx"],"names":["React","useState","useCallback","useEffect","useMutation","PostPresenter","removePostMutation","likeMutation","useVssState","useVssDispatch","SHOW_POST_MODAL","SHOW_LOGIN_MODAL","getAccessToken","PostContainer","id","title","description","createdAt","user","video","status","likes","userId","dispatch","isMyPost","ctrlIsLiked","setCtrlIsLiked","some","v","ctrlLikeCount","setCtrlLikeCount","length","isShowUser","setIsShowUser","like","loading","likeLoading","remove","removeLoading","handleClickAvatar","handleRoom","token","type","handleUpdate","postId","url","handleLike","variables","error","message","JSON","parse","alert","handleDelete","tf","confirm","data","deletePost","window","location","reload"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect, FC } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport PostPresenter from \"./PostPresenter\";\nimport { removePostMutation } from \"../../graphql/post/mutation/remove\";\nimport { likeMutation } from \"../../graphql/post/mutation/like\";\nimport {\n  useVssState,\n  useVssDispatch,\n  SHOW_POST_MODAL,\n  SHOW_LOGIN_MODAL\n} from \"../../context\";\nimport { getAccessToken } from \"../../lib/token\";\n\nexport type PostProps = {\n  id: string;\n  title: string;\n  description: string;\n  video: any;\n  user: any;\n  likes: any;\n  createdAt: string;\n  updatedAt: string;\n  status: string;\n  room: any;\n};\n\nconst PostContainer: FC<PostProps> = ({\n  id,\n  title,\n  description,\n  createdAt,\n  user,\n  video,\n  status,\n  likes\n  // room\n}) => {\n  const { userId } = useVssState();\n  const dispatch = useVssDispatch();\n\n  const isMyPost = userId || userId === user.id;\n  const [ctrlIsLiked, setCtrlIsLiked] = useState<boolean>(\n    likes.some((v: any) => v.user.id === userId)\n  );\n  const [ctrlLikeCount, setCtrlLikeCount] = useState<number>(likes.length);\n  const [isShowUser, setIsShowUser] = useState<boolean>(false);\n\n  const [like, { loading: likeLoading }] = useMutation(likeMutation);\n  const [remove, { loading: removeLoading }] = useMutation(removePostMutation);\n\n  const handleClickAvatar = useCallback(() => {\n    setIsShowUser(!isShowUser);\n  }, [isShowUser]);\n\n  // 포스트 채팅방 접근 이벤트\n  const handleRoom = useCallback(() => {\n    const token = getAccessToken();\n    if (token) {\n      //Router.push(`/room/${room.id}`);\n    } else {\n      dispatch({\n        type: SHOW_LOGIN_MODAL\n      });\n    }\n  }, []);\n\n  // 포스트 수정 이벤트\n  const handleUpdate = useCallback(() => {\n    dispatch({\n      type: SHOW_POST_MODAL,\n      postId: id,\n      title,\n      description,\n      status,\n      url: video.url\n    });\n  }, []);\n\n  // 좋아요 / 좋아요 취소 이벤트\n  const handleLike = useCallback(async () => {\n    const token = getAccessToken();\n    if (token) {\n      setCtrlIsLiked(!ctrlIsLiked);\n      setCtrlLikeCount(ctrlIsLiked ? ctrlLikeCount - 1 : ctrlLikeCount + 1);\n\n      try {\n        await like({\n          variables: { postId: id }\n        });\n      } catch (error) {\n        const { message } = JSON.parse(error.message);\n        alert(message);\n      }\n    } else {\n      dispatch({\n        type: SHOW_LOGIN_MODAL\n      });\n    }\n  }, [ctrlIsLiked, ctrlLikeCount, likeLoading]);\n\n  // 삭제 이벤트\n  const handleDelete = useCallback(async () => {\n    if (removeLoading) {\n      return alert(\"요청중입니다. 잠시만 기다려주세요.\");\n    }\n\n    const tf = confirm(\"포스트를 삭제하시겠어요?\");\n\n    if (tf) {\n      try {\n        const {\n          data: { deletePost }\n        } = await remove({\n          variables: { postId: id }\n        });\n\n        if (deletePost) {\n          alert(\"포스트가 삭제되었습니다.\");\n          window.location.reload();\n        }\n      } catch (error) {\n        const { message } = JSON.parse(error.message);\n        alert(message);\n      }\n    }\n  }, [removeLoading]);\n\n  useEffect(() => {\n    setCtrlIsLiked(likes.some((v: any) => v.user.id === userId));\n  }, [userId]);\n\n  return (\n    <PostPresenter\n      title={title}\n      description={description}\n      status={status}\n      createdAt={createdAt}\n      user={user}\n      video={video}\n      isLiked={ctrlIsLiked}\n      likeCount={ctrlLikeCount}\n      isMyPost={isMyPost}\n      isShowUser={isShowUser}\n      onClickAvatar={handleClickAvatar}\n      onLike={handleLike}\n      onUpdate={handleUpdate}\n      onRoom={handleRoom}\n      onDelete={handleDelete}\n    />\n  );\n};\n\nexport default PostContainer;\n"]},"metadata":{},"sourceType":"module"}
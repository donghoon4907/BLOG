{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport Button from \"./Button\";\nimport { followMutation, unfollowMutation } from \"../../graphql/user/mutation/follow\";\nimport { getAccessToken } from \"../../lib/token\";\nimport { useVssDispatch, SHOW_LOGIN_MODAL } from \"../../context\";\n\nvar FollowButton = function FollowButton(_ref) {\n  var isFollowing = _ref.isFollowing,\n      userId = _ref.userId;\n  var dispatch = useVssDispatch();\n\n  var _useState = useState(isFollowing),\n      ctrlIsFolling = _useState[0],\n      setCtrlIsFolling = _useState[1];\n\n  var _useMutation = useMutation(followMutation),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      follow = _useMutation2[0],\n      followLoading = _useMutation2[1].loading;\n\n  var _useMutation3 = useMutation(unfollowMutation),\n      _useMutation4 = _slicedToArray(_useMutation3, 2),\n      unfollow = _useMutation4[0],\n      unfollowLoading = _useMutation4[1].loading;\n\n  var handleFollow = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var token, _yield$unfollow, data, _yield$follow, _data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            token = getAccessToken();\n\n            if (!token) {\n              _context.next = 21;\n              break;\n            }\n\n            if (!ctrlIsFolling) {\n              _context.next = 12;\n              break;\n            }\n\n            if (!unfollowLoading) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 5:\n            _context.next = 7;\n            return unfollow({\n              variables: {\n                userId: userId\n              }\n            });\n\n          case 7:\n            _yield$unfollow = _context.sent;\n            data = _yield$unfollow.data;\n\n            if (data.unfollow) {\n              setCtrlIsFolling(false);\n              alert(\"언팔로우 되었습니다.\");\n            }\n\n            _context.next = 19;\n            break;\n\n          case 12:\n            if (!followLoading) {\n              _context.next = 14;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 14:\n            _context.next = 16;\n            return follow({\n              variables: {\n                userId: userId\n              }\n            });\n\n          case 16:\n            _yield$follow = _context.sent;\n            _data = _yield$follow.data;\n\n            if (_data.follow) {\n              setCtrlIsFolling(true);\n              alert(\"팔로우 되었습니다.\");\n            }\n\n          case 19:\n            _context.next = 22;\n            break;\n\n          case 21:\n            dispatch({\n              type: SHOW_LOGIN_MODAL\n            });\n\n          case 22:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), [ctrlIsFolling, followLoading, unfollowLoading]);\n  useEffect(function () {\n    setCtrlIsFolling(isFollowing);\n  }, [isFollowing]);\n  return __jsx(Button, {\n    text: ctrlIsFolling ? \"언팔로우\" : \"팔로우\",\n    onClick: handleFollow\n  });\n};\n\nexport default FollowButton;","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"/Users/idonghun/Desktop/vss/frontend/components/common/FollowButton.tsx\";\nvar __jsx = React.createElement;\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport Button from \"./Button\";\nimport { followMutation, unfollowMutation } from \"../../graphql/user/mutation/follow\";\nimport { getAccessToken } from \"../../lib/token\";\nimport { useVssDispatch, SHOW_LOGIN_MODAL } from \"../../context\";\n\nconst FollowButton = ({\n  isFollowing,\n  userId\n}) => {\n  const dispatch = useVssDispatch();\n  const {\n    0: ctrlIsFolling,\n    1: setCtrlIsFolling\n  } = useState(isFollowing);\n  const [follow, {\n    loading: followLoading\n  }] = useMutation(followMutation);\n  const [unfollow, {\n    loading: unfollowLoading\n  }] = useMutation(unfollowMutation);\n  const handleFollow = useCallback(async () => {\n    const token = getAccessToken();\n\n    if (token) {\n      if (ctrlIsFolling) {\n        if (unfollowLoading) return;\n        const {\n          data\n        } = await unfollow({\n          variables: {\n            userId\n          }\n        });\n\n        if (data.unfollow) {\n          setCtrlIsFolling(false);\n          alert(\"언팔로우 되었습니다.\");\n        }\n      } else {\n        if (followLoading) return;\n        const {\n          data\n        } = await follow({\n          variables: {\n            userId\n          }\n        });\n\n        if (data.follow) {\n          setCtrlIsFolling(true);\n          alert(\"팔로우 되었습니다.\");\n        }\n      }\n    } else {\n      dispatch({\n        type: SHOW_LOGIN_MODAL\n      });\n    }\n  }, [ctrlIsFolling, followLoading, unfollowLoading]);\n  useEffect(() => {\n    setCtrlIsFolling(isFollowing);\n  }, [isFollowing]);\n  return __jsx(Button, {\n    text: ctrlIsFolling ? \"언팔로우\" : \"팔로우\",\n    onClick: handleFollow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 5\n    }\n  });\n};\n\nexport default FollowButton;","map":{"version":3,"sources":["/Users/idonghun/Desktop/vss/frontend/components/common/FollowButton.tsx"],"names":["React","useState","useCallback","useEffect","useMutation","Button","followMutation","unfollowMutation","getAccessToken","useVssDispatch","SHOW_LOGIN_MODAL","FollowButton","isFollowing","userId","dispatch","ctrlIsFolling","setCtrlIsFolling","follow","loading","followLoading","unfollow","unfollowLoading","handleFollow","token","data","variables","alert","type"],"mappings":";;AAAA,OAAOA,KAAP,IAAoBC,QAApB,EAA8BC,WAA9B,EAA2CC,SAA3C,QAA4D,OAA5D;AACA,SAASC,WAAT,QAA4B,gBAA5B;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SACEC,cADF,EAEEC,gBAFF,QAGO,oCAHP;AAIA,SAASC,cAAT,QAA+B,iBAA/B;AACA,SAASC,cAAT,EAAyBC,gBAAzB,QAAiD,eAAjD;;AAOA,MAAMC,YAAuB,GAAG,CAAC;AAAEC,EAAAA,WAAF;AAAeC,EAAAA;AAAf,CAAD,KAA6B;AAC3D,QAAMC,QAAQ,GAAGL,cAAc,EAA/B;AACA,QAAM;AAAA,OAACM,aAAD;AAAA,OAAgBC;AAAhB,MAAoCf,QAAQ,CAAUW,WAAV,CAAlD;AAEA,QAAM,CAACK,MAAD,EAAS;AAAEC,IAAAA,OAAO,EAAEC;AAAX,GAAT,IAAuCf,WAAW,CAACE,cAAD,CAAxD;AACA,QAAM,CAACc,QAAD,EAAW;AAAEF,IAAAA,OAAO,EAAEG;AAAX,GAAX,IAA2CjB,WAAW,CAC1DG,gBAD0D,CAA5D;AAIA,QAAMe,YAAY,GAAGpB,WAAW,CAAC,YAAY;AAC3C,UAAMqB,KAAK,GAAGf,cAAc,EAA5B;;AACA,QAAIe,KAAJ,EAAW;AACT,UAAIR,aAAJ,EAAmB;AACjB,YAAIM,eAAJ,EAAqB;AAErB,cAAM;AAAEG,UAAAA;AAAF,YAAW,MAAMJ,QAAQ,CAAC;AAC9BK,UAAAA,SAAS,EAAE;AAAEZ,YAAAA;AAAF;AADmB,SAAD,CAA/B;;AAGA,YAAIW,IAAI,CAACJ,QAAT,EAAmB;AACjBJ,UAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACAU,UAAAA,KAAK,CAAC,aAAD,CAAL;AACD;AACF,OAVD,MAUO;AACL,YAAIP,aAAJ,EAAmB;AAEnB,cAAM;AAAEK,UAAAA;AAAF,YAAW,MAAMP,MAAM,CAAC;AAC5BQ,UAAAA,SAAS,EAAE;AAAEZ,YAAAA;AAAF;AADiB,SAAD,CAA7B;;AAGA,YAAIW,IAAI,CAACP,MAAT,EAAiB;AACfD,UAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACAU,UAAAA,KAAK,CAAC,YAAD,CAAL;AACD;AACF;AACF,KAtBD,MAsBO;AACLZ,MAAAA,QAAQ,CAAC;AACPa,QAAAA,IAAI,EAAEjB;AADC,OAAD,CAAR;AAGD;AACF,GA7B+B,EA6B7B,CAACK,aAAD,EAAgBI,aAAhB,EAA+BE,eAA/B,CA7B6B,CAAhC;AA+BAlB,EAAAA,SAAS,CAAC,MAAM;AACda,IAAAA,gBAAgB,CAACJ,WAAD,CAAhB;AACD,GAFQ,EAEN,CAACA,WAAD,CAFM,CAAT;AAIA,SACE,MAAC,MAAD;AACE,IAAA,IAAI,EAAEG,aAAa,GAAG,MAAH,GAAY,KADjC;AAEE,IAAA,OAAO,EAAEO,YAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF;AAMD,CAlDD;;AAoDA,eAAeX,YAAf","sourcesContent":["import React, { FC, useState, useCallback, useEffect } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport Button from \"./Button\";\nimport {\n  followMutation,\n  unfollowMutation\n} from \"../../graphql/user/mutation/follow\";\nimport { getAccessToken } from \"../../lib/token\";\nimport { useVssDispatch, SHOW_LOGIN_MODAL } from \"../../context\";\n\ninterface Props {\n  isFollowing: boolean;\n  userId: string;\n}\n\nconst FollowButton: FC<Props> = ({ isFollowing, userId }) => {\n  const dispatch = useVssDispatch();\n  const [ctrlIsFolling, setCtrlIsFolling] = useState<boolean>(isFollowing);\n\n  const [follow, { loading: followLoading }] = useMutation(followMutation);\n  const [unfollow, { loading: unfollowLoading }] = useMutation(\n    unfollowMutation\n  );\n\n  const handleFollow = useCallback(async () => {\n    const token = getAccessToken();\n    if (token) {\n      if (ctrlIsFolling) {\n        if (unfollowLoading) return;\n\n        const { data } = await unfollow({\n          variables: { userId }\n        });\n        if (data.unfollow) {\n          setCtrlIsFolling(false);\n          alert(\"언팔로우 되었습니다.\");\n        }\n      } else {\n        if (followLoading) return;\n\n        const { data } = await follow({\n          variables: { userId }\n        });\n        if (data.follow) {\n          setCtrlIsFolling(true);\n          alert(\"팔로우 되었습니다.\");\n        }\n      }\n    } else {\n      dispatch({\n        type: SHOW_LOGIN_MODAL\n      });\n    }\n  }, [ctrlIsFolling, followLoading, unfollowLoading]);\n\n  useEffect(() => {\n    setCtrlIsFolling(isFollowing);\n  }, [isFollowing]);\n\n  return (\n    <Button\n      text={ctrlIsFolling ? \"언팔로우\" : \"팔로우\"}\n      onClick={handleFollow}\n    />\n  );\n};\n\nexport default FollowButton;\n"]},"metadata":{},"sourceType":"module"}
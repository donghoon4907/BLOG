{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/idonghun/Desktop/vss/frontend/components/common/FollowButton.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useCallback } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport Button from \"./Button\";\nimport { followMutation, unfollowMutation } from \"../../graphql/user/mutation/follow\";\nimport { getAccessToken } from \"../../lib/token\";\nimport { useVssDispatch, SHOW_LOGIN_MODAL } from \"../../context\";\n\nvar FollowButton = function FollowButton(_ref) {\n  _s();\n\n  var isFollowing = _ref.isFollowing,\n      userId = _ref.userId;\n  var dispatch = useVssDispatch();\n  console.log(\"before follow \".concat(isFollowing));\n\n  var _useState = useState(isFollowing),\n      ctrlIsFolling = _useState[0],\n      setCtrlIsFolling = _useState[1];\n\n  console.log(\"in follow \".concat(ctrlIsFolling));\n\n  var _useMutation = useMutation(followMutation),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      follow = _useMutation2[0],\n      followLoading = _useMutation2[1].loading;\n\n  var _useMutation3 = useMutation(unfollowMutation),\n      _useMutation4 = _slicedToArray(_useMutation3, 2),\n      unfollow = _useMutation4[0],\n      unfollowLoading = _useMutation4[1].loading;\n\n  var handleFollow = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var token, _yield$unfollow, data, _yield$follow, _data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            token = getAccessToken();\n\n            if (!token) {\n              _context.next = 21;\n              break;\n            }\n\n            if (!ctrlIsFolling) {\n              _context.next = 12;\n              break;\n            }\n\n            if (!unfollowLoading) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 5:\n            _context.next = 7;\n            return unfollow({\n              variables: {\n                userId: userId\n              }\n            });\n\n          case 7:\n            _yield$unfollow = _context.sent;\n            data = _yield$unfollow.data;\n\n            if (data.unfollow) {\n              setCtrlIsFolling(false);\n              alert(\"언팔로우 되었습니다.\");\n            }\n\n            _context.next = 19;\n            break;\n\n          case 12:\n            if (!followLoading) {\n              _context.next = 14;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 14:\n            _context.next = 16;\n            return follow({\n              variables: {\n                userId: userId\n              }\n            });\n\n          case 16:\n            _yield$follow = _context.sent;\n            _data = _yield$follow.data;\n\n            if (_data.follow) {\n              setCtrlIsFolling(true);\n              alert(\"팔로우 되었습니다.\");\n            }\n\n          case 19:\n            _context.next = 22;\n            break;\n\n          case 21:\n            dispatch({\n              type: SHOW_LOGIN_MODAL\n            });\n\n          case 22:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), [ctrlIsFolling, followLoading, unfollowLoading]);\n  return __jsx(Button, {\n    text: ctrlIsFolling ? \"언팔로우\" : \"팔로우\",\n    onClick: handleFollow,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 5\n    }\n  });\n};\n\n_s(FollowButton, \"J1qwmoqambM8xf8Dl4TqeWKbzgg=\", false, function () {\n  return [useVssDispatch, useMutation, useMutation];\n});\n\n_c = FollowButton;\nexport default FollowButton;\n\nvar _c;\n\n$RefreshReg$(_c, \"FollowButton\");","map":{"version":3,"sources":["/Users/idonghun/Desktop/vss/frontend/components/common/FollowButton.tsx"],"names":["React","useState","useCallback","useMutation","Button","followMutation","unfollowMutation","getAccessToken","useVssDispatch","SHOW_LOGIN_MODAL","FollowButton","isFollowing","userId","dispatch","console","log","ctrlIsFolling","setCtrlIsFolling","follow","followLoading","loading","unfollow","unfollowLoading","handleFollow","token","variables","data","alert","type"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,IAAoBC,QAApB,EAA8BC,WAA9B,QAAiD,OAAjD;AACA,SAASC,WAAT,QAA4B,gBAA5B;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SACEC,cADF,EAEEC,gBAFF,QAGO,oCAHP;AAIA,SAASC,cAAT,QAA+B,iBAA/B;AACA,SAASC,cAAT,EAAyBC,gBAAzB,QAAiD,eAAjD;;AAOA,IAAMC,YAAuB,GAAG,SAA1BA,YAA0B,OAA6B;AAAA;;AAAA,MAA1BC,WAA0B,QAA1BA,WAA0B;AAAA,MAAbC,MAAa,QAAbA,MAAa;AAC3D,MAAMC,QAAQ,GAAGL,cAAc,EAA/B;AACAM,EAAAA,OAAO,CAACC,GAAR,yBAA6BJ,WAA7B;;AAF2D,kBAGjBV,QAAQ,CAAUU,WAAV,CAHS;AAAA,MAGpDK,aAHoD;AAAA,MAGrCC,gBAHqC;;AAI3DH,EAAAA,OAAO,CAACC,GAAR,qBAAyBC,aAAzB;;AAJ2D,qBAMdb,WAAW,CAACE,cAAD,CANG;AAAA;AAAA,MAMpDa,MANoD;AAAA,MAMjCC,aANiC,oBAM1CC,OAN0C;;AAAA,sBAOVjB,WAAW,CAC1DG,gBAD0D,CAPD;AAAA;AAAA,MAOpDe,QAPoD;AAAA,MAO/BC,eAP+B,oBAOxCF,OAPwC;;AAW3D,MAAMG,YAAY,GAAGrB,WAAW,wEAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AACzBsB,YAAAA,KADyB,GACjBjB,cAAc,EADG;;AAAA,iBAE3BiB,KAF2B;AAAA;AAAA;AAAA;;AAAA,iBAGzBR,aAHyB;AAAA;AAAA;AAAA;;AAAA,iBAIvBM,eAJuB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,mBAMJD,QAAQ,CAAC;AAC9BI,cAAAA,SAAS,EAAE;AAAEb,gBAAAA,MAAM,EAANA;AAAF;AADmB,aAAD,CANJ;;AAAA;AAAA;AAMnBc,YAAAA,IANmB,mBAMnBA,IANmB;;AAS3B,gBAAIA,IAAI,CAACL,QAAT,EAAmB;AACjBJ,cAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACAU,cAAAA,KAAK,CAAC,aAAD,CAAL;AACD;;AAZ0B;AAAA;;AAAA;AAAA,iBAcvBR,aAduB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,mBAgBJD,MAAM,CAAC;AAC5BO,cAAAA,SAAS,EAAE;AAAEb,gBAAAA,MAAM,EAANA;AAAF;AADiB,aAAD,CAhBF;;AAAA;AAAA;AAgBnBc,YAAAA,KAhBmB,iBAgBnBA,IAhBmB;;AAmB3B,gBAAIA,KAAI,CAACR,MAAT,EAAiB;AACfD,cAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACAU,cAAAA,KAAK,CAAC,YAAD,CAAL;AACD;;AAtB0B;AAAA;AAAA;;AAAA;AAyB7Bd,YAAAA,QAAQ,CAAC;AACPe,cAAAA,IAAI,EAAEnB;AADC,aAAD,CAAR;;AAzB6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IA6B7B,CAACO,aAAD,EAAgBG,aAAhB,EAA+BG,eAA/B,CA7B6B,CAAhC;AA+BA,SACE,MAAC,MAAD;AACE,IAAA,IAAI,EAAEN,aAAa,GAAG,MAAH,GAAY,KADjC;AAEE,IAAA,OAAO,EAAEO,YAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF;AAMD,CAhDD;;GAAMb,Y;UACaF,c,EAK4BL,W,EACIA,W;;;KAP7CO,Y;AAkDN,eAAeA,YAAf","sourcesContent":["import React, { FC, useState, useCallback } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport Button from \"./Button\";\nimport {\n  followMutation,\n  unfollowMutation\n} from \"../../graphql/user/mutation/follow\";\nimport { getAccessToken } from \"../../lib/token\";\nimport { useVssDispatch, SHOW_LOGIN_MODAL } from \"../../context\";\n\ninterface Props {\n  isFollowing: boolean;\n  userId: string;\n}\n\nconst FollowButton: FC<Props> = ({ isFollowing, userId }) => {\n  const dispatch = useVssDispatch();\n  console.log(`before follow ${isFollowing}`);\n  const [ctrlIsFolling, setCtrlIsFolling] = useState<boolean>(isFollowing);\n  console.log(`in follow ${ctrlIsFolling}`);\n\n  const [follow, { loading: followLoading }] = useMutation(followMutation);\n  const [unfollow, { loading: unfollowLoading }] = useMutation(\n    unfollowMutation\n  );\n\n  const handleFollow = useCallback(async () => {\n    const token = getAccessToken();\n    if (token) {\n      if (ctrlIsFolling) {\n        if (unfollowLoading) return;\n\n        const { data } = await unfollow({\n          variables: { userId }\n        });\n        if (data.unfollow) {\n          setCtrlIsFolling(false);\n          alert(\"언팔로우 되었습니다.\");\n        }\n      } else {\n        if (followLoading) return;\n\n        const { data } = await follow({\n          variables: { userId }\n        });\n        if (data.follow) {\n          setCtrlIsFolling(true);\n          alert(\"팔로우 되었습니다.\");\n        }\n      }\n    } else {\n      dispatch({\n        type: SHOW_LOGIN_MODAL\n      });\n    }\n  }, [ctrlIsFolling, followLoading, unfollowLoading]);\n\n  return (\n    <Button\n      text={ctrlIsFolling ? \"언팔로우\" : \"팔로우\"}\n      onClick={handleFollow}\n    />\n  );\n};\n\nexport default FollowButton;\n"]},"metadata":{},"sourceType":"module"}
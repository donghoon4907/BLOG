{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useCallback, useState, useEffect } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport { addNoticeMutation } from \"../../graphql/notice/mutation/add\";\nimport { updateNoticeMutation } from \"../../graphql/notice/mutation/update\";\nimport { removeNoticeMutation } from \"../../graphql/notice/mutation/remove\";\nimport SetNoticePresenter from \"./SetNoticePresenter\";\nimport { useInput, useLazyAxios } from \"../../hooks\";\nimport { useVssDispatch, SET_NOTICE_MODAL } from \"../../context\";\nexport default (props => {\n  const dispatch = useVssDispatch();\n  const {\n    loading,\n    call\n  } = useLazyAxios();\n  const title = useInput(props.title);\n  const description = useInput(props.description);\n  const {\n    0: mdDescription,\n    1: setMdDescription\n  } = useState(\"\");\n  const {\n    0: preview,\n    1: setPreview\n  } = useState(\"\");\n  const {\n    0: action,\n    1: setAction\n  } = useState({\n    code: props.action,\n    modalTitle: props.actionText\n  }); // readonly, modifiable, modify, add\n\n  const [add, {\n    loading: addNoticeLoading\n  }] = useMutation(addNoticeMutation);\n  const [update, {\n    loading: updateNoticeLoading\n  }] = useMutation(updateNoticeMutation);\n  const [remove, {\n    loading: removeNoticeLoading\n  }] = useMutation(removeNoticeMutation);\n\n  const convertTextIntoMd = async text => {\n    if (!text) return alert(\"내용을 입력하세요.\");\n    const {\n      data,\n      error\n    } = await call({\n      method: \"post\",\n      url: process.env.MDAPI_PATH,\n      data: {\n        text,\n        mode: \"gfm\",\n        context: \"github/gollum\"\n      }\n    });\n\n    if (data) {\n      const doc = new DOMParser().parseFromString(data, \"text/html\");\n      return doc.body.innerHTML;\n    } else if (error) {\n      return null;\n    }\n  };\n\n  const handlePreView = useCallback(async () => {\n    if (loading) return;\n    const md = await convertTextIntoMd(description.value);\n\n    if (md) {\n      setPreview(md);\n    } else {\n      alert(\"미리보기 로드에 실패했습니다.\");\n    }\n  }, [description.value]);\n  const handleRefreshPreview = useCallback(() => {\n    setPreview(\"\");\n  }, []);\n  const handleClose = useCallback(() => {\n    dispatch({\n      type: SET_NOTICE_MODAL,\n      isShowNoticeModal: false\n    });\n  }, []);\n  const handleShowEdit = useCallback(() => {\n    setAction({\n      code: \"modify\",\n      modalTitle: \"수정\"\n    });\n  }, []);\n  const handleDelete = useCallback(async () => {\n    if (removeNoticeLoading) return alert(\"요청 중입니다.\");\n    const {\n      data: {\n        deleteNotice\n      }\n    } = await remove({\n      variables: {\n        noticeId: props.noticeId\n      }\n    });\n\n    if (deleteNotice) {\n      alert(\"공지사항이 삭제되었습니다.\");\n      window.location.reload();\n    }\n  }, [removeNoticeLoading]);\n  const handleSubmit = useCallback(async () => {\n    if (!title.value) {\n      return alert(\"제목을 입력하세요.\");\n    }\n\n    if (!description.value) {\n      return alert(\"내용을 입력하세요.\");\n    }\n\n    if (action.code === \"add\") {\n      if (addNoticeLoading) return alert(\"요청 중입니다.\");\n      const {\n        data: {\n          addNotice\n        }\n      } = await add({\n        variables: {\n          title: title.value,\n          description: description.value\n        }\n      });\n\n      if (addNotice) {\n        alert(\"공지사항이 등록되었습니다.\");\n        window.location.reload();\n      }\n    } else if (action.code === \"modify\") {\n      if (updateNoticeLoading) return alert(\"요청 중입니다.\");\n      const {\n        data: {\n          updateNotice\n        }\n      } = await update({\n        variables: {\n          title: title.value,\n          description: description.value,\n          noticeId: props.noticeId\n        }\n      });\n\n      if (updateNotice) {\n        alert(\"공지사항이 수정되었습니다.\");\n        window.location.reload();\n      }\n    }\n  }, [action.code, title.value, description.value, addNoticeLoading, updateNoticeLoading]);\n  useEffect(() => {\n    async function update(value) {\n      const md = await convertTextIntoMd(value);\n\n      if (md) {\n        setMdDescription(md);\n      }\n    }\n\n    if (props.description) {\n      update(props.description);\n    }\n  }, []);\n  return __jsx(SetNoticePresenter, {\n    action: action,\n    isMaster: props.isMaster,\n    title: title,\n    description: description,\n    mdDescription: mdDescription,\n    preview: preview,\n    onShowEdit: handleShowEdit,\n    onPreview: handlePreView,\n    onRefreshPreview: handleRefreshPreview,\n    onClose: handleClose,\n    onDelete: handleDelete,\n    onSubmit: handleSubmit\n  });\n});","map":{"version":3,"sources":["/Users/idonghun/Desktop/vss/frontend/components/modal/SetNoticeContainer.tsx"],"names":["React","useCallback","useState","useEffect","useMutation","addNoticeMutation","updateNoticeMutation","removeNoticeMutation","SetNoticePresenter","useInput","useLazyAxios","useVssDispatch","SET_NOTICE_MODAL","props","dispatch","loading","call","title","description","mdDescription","setMdDescription","preview","setPreview","action","setAction","code","modalTitle","actionText","add","addNoticeLoading","update","updateNoticeLoading","remove","removeNoticeLoading","convertTextIntoMd","text","alert","data","error","method","url","process","env","MDAPI_PATH","mode","context","doc","DOMParser","parseFromString","body","innerHTML","handlePreView","md","value","handleRefreshPreview","handleClose","type","isShowNoticeModal","handleShowEdit","handleDelete","deleteNotice","variables","noticeId","window","location","reload","handleSubmit","addNotice","updateNotice","isMaster"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useEffect } from \"react\";\nimport { useMutation } from \"@apollo/client\";\nimport { addNoticeMutation } from \"../../graphql/notice/mutation/add\";\nimport { updateNoticeMutation } from \"../../graphql/notice/mutation/update\";\nimport { removeNoticeMutation } from \"../../graphql/notice/mutation/remove\";\nimport SetNoticePresenter from \"./SetNoticePresenter\";\nimport { useInput, useLazyAxios } from \"../../hooks\";\nimport { useVssDispatch, SET_NOTICE_MODAL } from \"../../context\";\n\nexport default props => {\n  const dispatch = useVssDispatch();\n  const { loading, call } = useLazyAxios();\n  const title = useInput(props.title);\n  const description = useInput(props.description);\n  const [mdDescription, setMdDescription] = useState(\"\");\n  const [preview, setPreview] = useState(\"\");\n  const [action, setAction] = useState({\n    code: props.action,\n    modalTitle: props.actionText\n  }); // readonly, modifiable, modify, add\n\n  const [add, { loading: addNoticeLoading }] = useMutation(addNoticeMutation);\n\n  const [update, { loading: updateNoticeLoading }] = useMutation(\n    updateNoticeMutation\n  );\n\n  const [remove, { loading: removeNoticeLoading }] = useMutation(\n    removeNoticeMutation\n  );\n\n  const convertTextIntoMd = async text => {\n    if (!text) return alert(\"내용을 입력하세요.\");\n\n    const { data, error } = await call({\n      method: \"post\",\n      url: process.env.MDAPI_PATH,\n      data: {\n        text,\n        mode: \"gfm\",\n        context: \"github/gollum\"\n      }\n    });\n    if (data) {\n      const doc = new DOMParser().parseFromString(data, \"text/html\");\n      return doc.body.innerHTML;\n    } else if (error) {\n      return null;\n    }\n  };\n\n  const handlePreView = useCallback(async () => {\n    if (loading) return;\n    const md = await convertTextIntoMd(description.value);\n\n    if (md) {\n      setPreview(md);\n    } else {\n      alert(\"미리보기 로드에 실패했습니다.\");\n    }\n  }, [description.value]);\n\n  const handleRefreshPreview = useCallback(() => {\n    setPreview(\"\");\n  }, []);\n\n  const handleClose = useCallback(() => {\n    dispatch({\n      type: SET_NOTICE_MODAL,\n      isShowNoticeModal: false\n    });\n  }, []);\n\n  const handleShowEdit = useCallback(() => {\n    setAction({\n      code: \"modify\",\n      modalTitle: \"수정\"\n    });\n  }, []);\n\n  const handleDelete = useCallback(async () => {\n    if (removeNoticeLoading) return alert(\"요청 중입니다.\");\n\n    const {\n      data: { deleteNotice }\n    } = await remove({\n      variables: {\n        noticeId: props.noticeId\n      }\n    });\n    if (deleteNotice) {\n      alert(\"공지사항이 삭제되었습니다.\");\n      window.location.reload();\n    }\n  }, [removeNoticeLoading]);\n\n  const handleSubmit = useCallback(async () => {\n    if (!title.value) {\n      return alert(\"제목을 입력하세요.\");\n    }\n\n    if (!description.value) {\n      return alert(\"내용을 입력하세요.\");\n    }\n\n    if (action.code === \"add\") {\n      if (addNoticeLoading) return alert(\"요청 중입니다.\");\n\n      const {\n        data: { addNotice }\n      } = await add({\n        variables: {\n          title: title.value,\n          description: description.value\n        }\n      });\n      if (addNotice) {\n        alert(\"공지사항이 등록되었습니다.\");\n        window.location.reload();\n      }\n    } else if (action.code === \"modify\") {\n      if (updateNoticeLoading) return alert(\"요청 중입니다.\");\n\n      const {\n        data: { updateNotice }\n      } = await update({\n        variables: {\n          title: title.value,\n          description: description.value,\n          noticeId: props.noticeId\n        }\n      });\n      if (updateNotice) {\n        alert(\"공지사항이 수정되었습니다.\");\n        window.location.reload();\n      }\n    }\n  }, [\n    action.code,\n    title.value,\n    description.value,\n    addNoticeLoading,\n    updateNoticeLoading\n  ]);\n\n  useEffect(() => {\n    async function update(value) {\n      const md = await convertTextIntoMd(value);\n      if (md) {\n        setMdDescription(md);\n      }\n    }\n    if (props.description) {\n      update(props.description);\n    }\n  }, []);\n\n  return (\n    <SetNoticePresenter\n      action={action}\n      isMaster={props.isMaster}\n      title={title}\n      description={description}\n      mdDescription={mdDescription}\n      preview={preview}\n      onShowEdit={handleShowEdit}\n      onPreview={handlePreView}\n      onRefreshPreview={handleRefreshPreview}\n      onClose={handleClose}\n      onDelete={handleDelete}\n      onSubmit={handleSubmit}\n    />\n  );\n};\n"]},"metadata":{},"sourceType":"module"}